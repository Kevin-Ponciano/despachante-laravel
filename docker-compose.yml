version: '3.9'

services:
    laravel-app:
        # urnau/php82-app-2023:horizon
        container_name: laravel-app
        build:
            context: .
            dockerfile: ./docker/Dockerfile
            args:
                PHP_VERSION: '8.3.2-bullseye'
        ports:
            - "8080:80" #http
            - "8443:443" #https
        networks:
            - traefik_public
        deploy:
            labels:
                - "traefik.enable=true"
                - "traefik.http.routers.laravel-app.rule=Host(`app.laravix.com.br`)"
                - "traefik.http.services.laravel-app.loadbalancer.server.port=8443"
                - "traefik.http.routers.laravel-app.service=laravel-app"
                - "traefik.http.routers.laravel-app.entrypoints=https"
                - "traefik.http.routers.laravel-app.tls=true"
            replicas: 1
            restart_policy:
                condition: on-failure
networks:
    traefik_public:
        external: true
